<!doctype html>
<html lang="ru ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Parser NAU</title>
    <style>
        #container1, container2, container3  {
            width: 100%;
            height: 720px;
        }

        .table_project {
            font-size: 14px;
            margin-left: 5%;
            margin-right: 5%;
            width: 90%;
        }

        img {
            height: 30px;
            width: 30px;
        }
        .sortUp:hover {
            cursor: pointer;
        }
        a{
            word-wrap: break-word;
        }
        .down {
            transform: rotate(180deg);
        }
        @media (min-width: 500px) and (max-width: 900px) {
            .table_project {
                overflow-x: hidden;
                font-size: 15px;
                width: 100%;
            }

            img {
                height: 30px;
                width: 30px;
            }
        }

        @media (max-width: 500px) {
            .table_project {
                font-size: 9px;
                margin: 0;
                width: 100%;
            }

            img {
                height: 15px;
                width: 15px;
            }
        }

    </style>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
<div class="table_project">
    <h5 class="friend text-center">Проекти команди НАУ</h5>
    <hr class="px-0 py-1 mx-0 my-0">
    <div class="row">
        <div class="col-1 text-center number z">№</div>
        <div class="col-2 pr-0 amount z">Назва<br/>Бюджет</div>
        <div class="col-1 pl-0 retng mr-2 text-center z">Рейтинг
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort">
        </div>
        <div class="col-1 pl-0 10min_info text-center z">10хв
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 1h_info text-center z">1год
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 3h_info text-center z">3год
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 6h_info text-center z">6год
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 12h_info text-center z">12год
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 24h_info text-center z">24год
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
        <div class="col-1 pl-0 full_info text-center z">Всього
            <img src="../images/iconfinder_chevron-circle-down_1608620.svg" class="sortUp" alt="sort"></div>
    </div>
    <hr class="px-0 py-1 mx-0 my-0">
    <% data.forEach(function (value1, index) { %>
    <div class="row sort_rows">
        <div class="col-1 number"><%= value1.number %></div>
        <div class="col-2 project_link pr-0 mr-2">
            <a target="_blank" href="<%=value1.link %>"> <%= value1.name %></a><br/><div class="amount"><%= value1.amount %>грн</div></div>
        <div class="col-1 text-center pl-0 retng"><%=  Math.round(value1.suffrage/value1.amount * 10000000) %></div>
        <div class="col-1 text-center pl-0 10min_info"><%= value1.ten %></div>
        <div class="col-1 text-center pl-0 1h_info"><%= value1.hour1 %></div>
        <div class="col-1 text-center pl-0 3h_info"><%= value1.hour3 %></div>
        <div class="col-1 text-center pl-0 6h_info"><%= value1.hour6 %></div>
        <div class="col-1 text-center pl-0 12h_info"><%= value1.hour12 %></div>
        <div class="col-1 text-center pl-0 24h_info"><%= value1.hour24 %></div>
        <div class="col-1 pl-0 text-center full_info"><%= value1.suffrage %></div>
    </div>
    <hr class="px-0 py-1 mx-0 my-0">
    <% if(index == 11) { %>
    <h5 class="friend hide text-center">Дружні проекти</h5>
    <hr class="px-0 py-1 mx-0 my-0 hide">
    <% } %>
    <% }); %>
</div>
<div id="container3"></div>
<div id="container1"></div>
<div id="container2"></div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" type="text/javascript"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/sort.js" type="text/javascript"></script>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script>
    var data = [];
    let series = [], seriesSUM = [], seriesRg = [];
    $.ajax({
        url: '/select',
        complete: function(dataJSON) {
            //console.log(dataJSON.responseJSON.data);
            data = JSON.parse(dataJSON.responseJSON.data);
            console.log(data);
            data.forEach(function (value,index) {
                let obj = {
                    name: value.number,
                    data: value.data
                };
                let objSUM = {
                    name: value.number  + " " + value.name,
                    data: value.dataSUM
                };
                let objRg = {
                    name: value.number + " " + value.name,
                    data: value.dataRg
                };
                series.push(obj);
                seriesSUM.push(objSUM);
                seriesRg.push(objRg);
            });
            //console.log(seriesRg);
            create("container1",series,"Часова статистика",(600 * 1000));
            create("container2",seriesSUM, "Сумарна статистика",(3600 * 1000));
            create("container3",seriesRg, "Рейтингова статистика",(3600 * 1000));
        }
    });
    function create(container,series,text,interval) {
        Highcharts.stockChart(container, {

            title: {
                text: text
            },

            subtitle: {
                text: ''
            },
            xAxis: {
                type: 'datetime'
            },
            yAxis: {
                title: {
                    text: 'Кількість голосів'
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },
            plotOptions: {
                series: {
                    showInNavigator: true,
                    label: {
                        connectorAllowed: true
                    },
                    pointStart: Date.UTC(2019, 5, 15,8),
                    pointInterval: interval
                }
            },
            series: series,

            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 500
                    },
                    chartOptions: {
                        legend: {
                            layout: 'horizontal',
                            align: 'center',
                            verticalAlign: 'bottom'
                        }
                    }
                }]
            }

        });
    }
</script>
</body>
</html>